angular.module("App",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,i){var e="/partials",n=e+"/templates";i.otherwise("/main"),t.state("main",{url:"/main",templateUrl:n+"/main.html",controller:"mainCtrl"})}]),angular.module("App").factory("Project",["Loader","Animator","Map",function(t,i,e){return function(n){this.loader=new t(n),this.animator=new i({project:this}),new e({project:this}),this.animator.Start()}}]),angular.module("App").factory("Hex",["Prefab","util","$q",function(t,i,e){return function(t){function e(){var t=new THREE.Vector2(this.x,this.y),i=[];_.times(6,function(e){i[e]=n(t,this.size,e)}.bind(this));for(var e=6;e<36;e+=6){var o=i[e/6-1],r=i[e/6];this.points[e-6]=r.x,this.points[e-5]=0,this.points[e-4]=r.y,this.points[e-3]=o.x,this.points[e-2]=0,this.points[e-1]=o.y}this.points[30]=i[0].x,this.points[31]=0,this.points[32]=i[0].y,this.points[33]=i[5].x,this.points[34]=0,this.points[35]=i[5].y}function n(t,e,n){var o=i.Deg2Rad(60*n+30);return new THREE.Vector2(t.x+e*Math.cos(o),t.y+e*Math.sin(o))}t=t||{},this.name="Hex",this.id="",this.layer="",this.meshes=[],this.components=[],this.uid=_.uniqueId(),this.x=t.x||0,this.y=t.y||0,this.size=t.size||1,this.points=new Float32Array(36),this.Start=function(t){e.bind(this)()}}}]),angular.module("App").factory("Map",["Prefab","util","$q","Grid",function(t,i,e,n){return function(t){function i(){return this.loader.LoadPrefab("Grid",t.grid)}function e(){return this.loader.LoadPrefab("TopDownCam",{animator:this.project.animator,grid:this.grid})}this.project=t.project,this.loader=this.project.loader,this.grid=void 0,function(){i.bind(this)().then(function(t){this.grid=t,e.bind(this)()}.bind(this))}.bind(this)()}}]),angular.module("App").factory("Component",[function(){return function(){this.name="",this.meshes=[],this.Start=function(){},this.Stop=function(){},this.Destroy=function(){},this.Update=function(){}}}]),angular.module("App").factory("Rotate",["Component",function(t){return function(){t.call(this),this.velocity=new THREE.Vector3,this.Start=function(t){this.velocity=t||this.velocity},this.Update=function(t){this.prefab.rotation.x+=this.velocity.x*t,this.prefab.rotation.y+=this.velocity.y*t,this.prefab.rotation.z+=this.velocity.z*t}}}]),angular.module("App").controller("mainCtrl",["$scope","Project",function(t,i){new i("testProject")}]),angular.module("App").factory("Cube",["Prefab","util","$q",function(t,i,e){return function(){function n(t){var n=e.defer(),o=[],r=[];return _.times(t,function(){var t=e.defer();this.loader.LoadMesh("cube").then(function(e){e.material.materials[0].color.setHex(255*Math.random()),e.AddComponent("Rotate"),e.components.Rotate.velocity.x=i.Deg2Rad(Math.random()),e.components.Rotate.velocity.y=i.Deg2Rad(Math.random()),e.components.Rotate.velocity.z=i.Deg2Rad(Math.random()),o.push(e),t.resolve(),this.add(e)}.bind(this)),r.push(t)}.bind(this)),e.all(r).then(function(){n.resolve(o)}),n.promise}function o(t){_.each(t,function(e,n){var o=10;e.position.x=o*Math.cos(i.Deg2Rad(360/t.length*n)),e.position.y=o*Math.sin(i.Deg2Rad(360/t.length*n))}.bind(this))}t.call(this),this.name="Cube",this.id="",this.layer="",this.meshes=["cube"],this.components=["Rotate"],this.uid=_.uniqueId(),this.Start=function(t){n.bind(this)(40).then(o.bind(this)),this.components.Rotate.velocity.x=this.components.Rotate.velocity.y=this.components.Rotate.velocity.z=i.Deg2Rad(.3)}}}]),angular.module("App").factory("Grid",["Prefab","util","$q","Hex",function(t,i,e,n){return function(i){function e(){var t=new THREE.BufferGeometry,i=new Float32Array(this.size.width*this.size.height*36),e=0;_.times(this.size.width,function(t){_.times(this.size.height,function(s){var a=o.bind(this)(t,s),h={x:a.x,y:a.y,size:r};hex=new n(h),hex.Start(this.loader),i.set(hex.points,36*e++)}.bind(this))}.bind(this)),t.addAttribute("position",new THREE.BufferAttribute(i,3).setDynamic(!0)),this.add(new THREE.LineSegments(t,new THREE.LineBasicMaterial({color:255})))}function o(t,i){return t+=i%2*.5,{x:t*this.hexWidth,y:i*this.hexHeight}}t.call(this),i=i||{},this.name="Grid",this.id="",this.layer="",this.meshes=[],this.components=["Rotate"],this.uid=_.uniqueId();var r=1;this.size=i.size||{width:10,height:10},this.hexHeight=2*r,this.hexWidth=Math.sqrt(3)/2*this.hexHeight,this.hexHeight-=this.hexHeight/4,this.Start=function(t){e.bind(this)()}}}]),angular.module("App").factory("Planet",["Prefab","util","$q",function(t,i,e){return function(){function e(){var t=10,i=n(new THREE.BoxGeometry(o.size,o.size,o.size,t,t,t)),e=new THREE.MeshBasicMaterial({color:65280,wireframe:!0});return new THREE.Mesh(i,e)}function n(t){return _.each(t.vertices,function(t){t.normalize().multiplyScalar(o.size)}),t}t.call(this),this.components=["Rotate"];var o=this;this.size=2,this.Start=function(t){this.add(e()),this.components.Rotate.velocity.x=this.components.Rotate.velocity.y=this.components.Rotate.velocity.z=i.Deg2Rad(.3)}}}]),angular.module("App").factory("Prefab",[function(){return function(){THREE.Object3D.call(this),this.name="",this.id="",this.layer="",this.meshes=[],this.components=[],this.uid=_.uniqueId(),this.Start=function(){},this.Stop=function(){},this.Destroy=function(){},this.Update=function(){},this.AddComponent=function(t){this.loader.injector.AddComponent(this,t)}}}]),angular.module("App").factory("TopDownCam",["Prefab","util","$q","input",function(t,i,e,n){return function(i){function e(t){t.pageX>this.animator.renderer.windowWidth-this.borderPixelSize?(a.right=!0,a.left=!1):t.pageX<this.borderPixelSize?(a.right=!1,a.left=!0):a.right=a.left=!1,t.pageY>this.animator.renderer.windowHeight-this.borderPixelSize?(a.bottom=!0,a.top=!1):t.pageY<this.borderPixelSize?(a.bottom=!1,a.top=!0):a.bottom=a.top=!1}function o(t,i){if(a[t]===!1)return!1;switch(t){case"right":return this.camera.position.x+i<s.right;case"left":return this.camera.position.x-i>s.left;case"top":return this.camera.position.z+i>s.top;case"bottom":return this.camera.position.z-i<s.bottom;default:return!1}}t.call(this),i=i||{},this.animator=i.animator,this.camera=this.animator.camera,this.grid=i.grid,this.speed=i.speed||15,this.borderPixelSize=20;var r=!0,s={left:0,right:this.grid.size.width*this.grid.hexWidth,top:0,bottom:this.grid.size.height*this.grid.hexHeight},a={left:!1,right:!1,top:!1,bottom:!1};this.Start=function(t){n.AddEvent(document,"mousemove",e.bind(this))},this.Update=function(t){if(r!==!1){var i=this.speed*t;o.bind(this)("right",i)?this.camera.position.x+=i:o.bind(this)("left",i)&&(this.camera.position.x-=i),o.bind(this)("top",i)?this.camera.position.z-=i:o.bind(this)("bottom",i)&&(this.camera.position.z+=i)}},this.Toggle=function(t){r=t}}}]),angular.module("App").factory("Animator",["Renderer",function(t){return function(i){function e(){return new THREE.PerspectiveCamera(this.camFov,this.renderer.width/this.renderer.height,this.camNear,this.camFar)}i=i||{},this.project=i.project,this.camFov=i.camFov||45,this.camNear=i.camNear||1,this.camFar=i.camFar||1e3,this.renderer=new t({project:this.project,containerID:"WebGL"}),this.camera=e.bind(this)(),this.camera.position.y=20,this.camera.lookAt(new THREE.Vector3(0,0,0)),this.controls=void 0,this.Start=function(){this.renderer.Render()}}}]),angular.module("App").factory("Injector",["$q","$injector","paths","updater",function(t,i,e,n){return function(e){function o(t){return i.get(t)}function r(i){var e=t.defer(),n=[],o={};return _.each(i.meshes,function(t){var e=this.loader.LoadMesh(t);e.then(function(e){o[t]=e,i.add(e)}),n.push(e)}.bind(this)),t.all(n).then(function(){i.meshes=o,e.resolve(i)}),e.promise}function s(i){var e=t.defer();return _.each(i.components,function(t){this.AddComponent(i,t)}.bind(this)),e.resolve(),e.promise}this.loader=e,this.LoadPrefab=function(i,e){var a=t.defer(),h=o(i),c=(new THREE.Object3D,new h(e));return c=_.extend(new THREE.Object3D,c),r.bind(this)(c).then(s.bind(this)).then(function(){c.loader=this.loader,c.Update&&n.Add(c),a.resolve(c)}.bind(this)),a.promise},this.AddComponent=function(t,i){var e=o(i);t.components[i]=new e,t.components[i].prefab=t,n.Add(t.components[i])}}}]),angular.module("App").factory("Loader",["$q","$http","Injector","paths","Prefab",function(t,i,e,n,o){return function(r){function s(t){return t.loader=this,_.extend(t,new o)}function a(t){i.get(n.projects+"/"+t+".json").success(function(t){this.LoadPrefabs(t.prefabs)}.bind(this)).error(function(){console.error("could not read project "+t)})}this.scene=new THREE.Scene,this.injector=new e(this);var h=new THREE.JSONLoader,c={};a.bind(this)(r),this.LoadMesh=function(i){var e=t.defer();if(void 0!==c[i]){var o=new THREE.Mesh(c[i].geometry.clone(),c[i].material.clone());e.resolve(s.bind(this)(o))}else h.load(n.models+"/"+i+".json",function(t,n){var o=new THREE.MultiMaterial(n),r=new THREE.Mesh(t,o);e.resolve(s.bind(this)(r)),c[i]=r,e.resolve(r)}.bind(this));return e.promise},this.LoadPrefab=function(i,e,n){n=n||new THREE.Vector3,e=e||{};var o=t.defer();return this.injector.LoadPrefab(i,e).then(function(t){t.position.set(n.x,n.y,n.z),this.Add(t),t.Start(this),o.resolve(t)}.bind(this)),o.promise},this.LoadPrefabs=function(i){var e=t.defer(),n=[];return _.each(i,function(t){var i=this.LoadPrefab(t.name,t.position);i.then(function(t){}),n.push(i)}.bind(this)),t.all(n).then(function(){e.resolve()}),e.promise},this.Add=function(t,i){i=i||this.scene,i.add(t)},this.Remove=function(t){this.scene.remove(t)}}}]),angular.module("App").factory("Renderer",["updater",function(t){return function(i){function e(t){try{var i=$("#"+t);if(0===i.length)throw"could not find container with ID "+t;return i}catch(e){console.error(e)}}function n(t,i){var e=new THREE.WebGLRenderer({antialias:!0});return e.setSize(t,i),$(this.container).append(e.domElement),e}i=i||{},this.project=i.project,this.container=e(i.containerID||"WebGL"),this.width=$(this.container).outerWidth(),this.height=$(this.container).outerHeight(),this.windowWidth=$(window).width(),this.windowHeight=$(window).height(),this.renderer=n.bind(this)(this.width,this.height);var o,r,s,a=_.now(),h=a;this.Render=function(i){a=_.now(),r=a-h,s=r/1e3,h=a,t.Update(s,r),this.renderer.render(this.project.loader.scene,this.project.animator.camera),o=requestAnimationFrame(this.Render.bind(this))}}}]),angular.module("App").factory("input",[function(){return new function(){this.AddEvent=function(t,i,e){$(t)[i](e)}}}]),angular.module("App").factory("paths",[function(){return new function(){this.js="./js",this.prefabs=this.js+"/prefabs",this.assets="./assets",this.models=this.assets+"/models",this.projects=this.assets+"/projects"}}]),angular.module("App").factory("updater",["$log",function(t){return{handlers:[],renderFunction:void 0,Add:function(t){this.handlers.push(t)},Remove:function(t){var i=this.handlers.indexOf(t);i>-1&&this.handlers.splice(i,1)},ReturnIndex:function(t){var i=this.handlers.indexOf(t);return i>-1&&i},Update:function(t,i){_.each(this.handlers,function(e){e.Update(t,i)})},ClearAll:function(){this.handlers=[]}}}]),angular.module("App").factory("util",[function(){return new function(){this.Deg2Rad=function(t){return t*(Math.PI/180)},this.Rad2Deg=function(t){return t*(180/Math.PI)},this.RandomNumber=function(t,i){return Math.floor(Math.random()*(i-t+1)+t)}}}]),angular.module("App").factory("Shader",[function(){return function(){}}]);